``` abap
*&---------------------------------------------------------------------*
*& Include          ZC103PM0001F01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*& Form handle_button_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> ES_COL_ID
*&      --> ES_ROW_NO
*&      --> sender
*&---------------------------------------------------------------------*
FORM handle_button_click  USING    ps_col_id TYPE lvc_s_col
                                   ps_row_no TYPE lvc_s_roid
                                   po_sender TYPE REF TO cl_gui_alv_grid.

  CASE po_sender.
    WHEN go_disp_sch_alv.

      DATA lv_scheduleid TYPE  zc103e_sd_scheduleid.

      lv_scheduleid = gt_disp_sch[ ps_row_no-row_id ]-scheduleid.

      PERFORM  salv_display USING lv_scheduleid.
  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_double_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW
*&      --> E_COLUMN
*&---------------------------------------------------------------------*
FORM handle_double_click  USING    pv_row
                                   pv_column
                                   po_sender TYPE REF TO cl_gui_alv_grid.


ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_hotspot_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW_ID
*&      --> E_COLUMN_ID
*&---------------------------------------------------------------------*
FORM handle_hotspot_click  USING    pv_row_id
                                    pv_column_id
                                   po_sender TYPE REF TO cl_gui_alv_grid.

*  CASE po_sender.
*  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM handle_edit_toolbar USING po_object TYPE
                                         REF TO cl_alv_event_toolbar_set
                               pv_interactive
                               po_sender TYPE REF TO cl_gui_alv_grid.

  CASE po_sender.
    WHEN go_disp_sch_alv.

      PERFORM make_divide_line USING po_object.

      IF gv_make_status = 'E'.

        PERFORM make_btn USING 'MAKE' icon_okay ' Make Order'
                               ' 오더생성'  po_object.

        PERFORM make_divide_line USING po_object.

      ENDIF.

      IF gv_green_status = 'E'.

        PERFORM make_btn USING 'GREE' icon_led_green ' 정비 오더가 생성된 스케줄만 조회합니다.'
                               ' 정비대상'  po_object.

        PERFORM make_divide_line USING po_object.

      ENDIF.

      IF gv_yellow_status = 'E'.

        PERFORM make_btn USING 'YELL' icon_led_yellow' 정비 오더를 생성해야 하는 스케줄만 조회합니다.'
                               ' 정비예정'  po_object.

        PERFORM make_divide_line USING po_object.

      ENDIF.

  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form make_divide_line
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> PO_OBJCET
*&---------------------------------------------------------------------*
FORM make_divide_line USING po_object TYPE
                                      REF TO cl_alv_event_toolbar_set.

  po_object->mt_toolbar = VALUE #( BASE po_object->mt_toolbar ( butn_type = '3' ) ).

ENDFORM.

*&---------------------------------------------------------------------*
*& Form make_btn
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> ICON_TOGGLE_DISPLAY_CHANGE
*&      --> P_
*&---------------------------------------------------------------------*
FORM make_btn USING pv_function pv_icon pv_quick po_text
                    po_object TYPE REF TO cl_alv_event_toolbar_set.

  po_object->mt_toolbar = VALUE #( BASE po_object->mt_toolbar ( text = po_text
                                                                function  = pv_function
                                                                icon      = pv_icon
                                                                quickinfo = pv_quick ) ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_modify_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_MODIFIED
*&      --> ET_GOOD_CELLS
*&---------------------------------------------------------------------*
FORM handle_modify_value USING pv_modified
                               pt_good_cells TYPE lvc_t_modi
                               po_sender TYPE REF TO cl_gui_alv_grid.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_user_command
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_UCOMM
*&---------------------------------------------------------------------*
FORM handle_user_command USING pv_ucomm
                               po_sender TYPE REF TO cl_gui_alv_grid.

  CASE pv_ucomm.
    WHEN 'MAKE'.
      PERFORM make_oder.
    WHEN 'GREE'.
      PERFORM set_data_green.
    WHEN 'YELL'.
      PERFORM set_data_yellow.
  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form expand_no_children
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> NODE_KEY
*&      --> ITEM_NAME
*&---------------------------------------------------------------------*
FORM expand_no_children  USING    p_node_key  TYPE tv_nodekey .

  DATA : node_table TYPE treev_ntab,
         node       TYPE treev_node,
         item_table TYPE STANDARD TABLE OF mtreeitm,
         item       TYPE mtreeitm.

  IF p_node_key = 'Child1'.

    CLEAR node.
    node-node_key = 'P01'.
    node-relatkey = p_node_key.
    node-n_image = '@7T@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P01'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P01'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P01'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P01 조회'.
    APPEND item TO item_table.

    CLEAR node.
    node-node_key = 'P02'.
    node-relatkey = p_node_key.
    node-n_image = '@7T@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P02'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P02'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P02'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P02 조회'.
    APPEND item TO item_table.

    CALL METHOD go_list_tree->add_nodes_and_items
      EXPORTING
        node_table                = node_table
        item_table                = item_table
        item_table_structure_name = 'MTREEITM'.

  ELSEIF p_node_key = 'Child2'.

    CLEAR node.
    node-node_key = 'P03'.
    node-relatkey = p_node_key.
    node-n_image = '@AV@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P03'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P03'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P03'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P03 조회'.
    APPEND item TO item_table.

    CLEAR node.
    node-node_key = 'P04'.
    node-relatkey = p_node_key.
    node-n_image = '@AV@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P04'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P04'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P04'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P04 조회'.
    APPEND item TO item_table.

    CLEAR node.
    node-node_key = 'P05'.
    node-relatkey = p_node_key.
    node-n_image = '@AV@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P05'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P05'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P05'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P05 조회'.
    APPEND item TO item_table.

    CLEAR node.
    node-node_key = 'P06'.
    node-relatkey = p_node_key.
    node-n_image = '@AV@'.
    node-last_hitem = '1'.
    node-relatship = cl_gui_list_tree=>relat_last_child.
    APPEND node TO node_table.

    CLEAR item.
    item-node_key = 'P06'.
    item-item_name = '1'.
    item-class = cl_gui_column_tree=>item_class_text.
    item-length = 5.
    item-text = 'P06'.
    APPEND item TO item_table.

    CLEAR item.
    item-node_key = 'P06'.
    item-item_name = '2'.
    item-class = cl_gui_column_tree=>item_class_button.
    item-alignment = cl_gui_list_tree=>align_center.
    item-length = 10.
    item-text = 'P06 조회'.
    APPEND item TO item_table.

    CALL METHOD go_list_tree->add_nodes_and_items
      EXPORTING
        node_table                = node_table
        item_table                = item_table
        item_table_structure_name = 'MTREEITM'.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form chart_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> POINT
*&      --> SERIES
*&---------------------------------------------------------------------*
FORM chart_click  USING    pv_series TYPE i
                           pv_point  TYPE i.

  DATA : lv_name   TYPE string,
         lv_value  TYPE i,
         lv_point  TYPE n LENGTH 2,
         lv_flight TYPE string.

  lv_point = pv_point.

  IF pv_point EQ 0.

    SKIP.

  ELSE.
    CASE pv_point.
      WHEN 1.
        lv_flight = 'P01'.
      WHEN 2.
        lv_flight = 'P02'.
      WHEN 3.
        lv_flight = 'P03'.
      WHEN 4.
        lv_flight = 'P04'.
      WHEN 5.
        lv_flight = 'P05'.
      WHEN 6.
        lv_flight = 'P06'.
    ENDCASE.
    CASE pv_series.
      WHEN 1.
        lv_name = |gv_gp{ lv_point }|.
        ASSIGN (lv_name) TO <fs_name>.
        lv_value = <fs_name>.
        MESSAGE i000 WITH |{ lv_flight } 항공기의 정비 오더가 생성 완료된 노선은 { lv_value }건입니다|.
      WHEN 2.
        lv_name = |gv_yp{ lv_point }|.
        ASSIGN (lv_name) TO <fs_name>.
        lv_value = <fs_name>.
        MESSAGE i000 WITH |{ lv_flight } 항공기의 정비 오더가 생성 가능한 노선은 { lv_value }건입니다|.
      WHEN 3.
        lv_name = |gv_rp{ lv_point }|.
        ASSIGN (lv_name) TO <fs_name>.
        lv_value = <fs_name>.
        MESSAGE i000 WITH |{ lv_flight } 항공기의 정비 오더 대상이 아닌 노선은 { lv_value }건입니다|.
    ENDCASE.

    UNASSIGN <fs_name>.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh_table USING po_object
                   TYPE REF TO cl_gui_alv_grid.

  DATA : ls_stable TYPE lvc_s_stbl.

  ls_stable = VALUE #(
                        row = abap_true
                        col = abap_true
                     ).
  po_object->refresh_table_display(
    EXPORTING
      is_stable = ls_stable ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form make_oder
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM make_oder .

*-- 변수 초기화
  CLEAR : gs_check, gs_ooh.

*-- 항공기 누적 비행시간 조회
  SELECT SINGLE
    FROM zc103pmt0015
    FIELDS fh_since_last_a, fh_since_last_c, fh_since_last_d
    WHERE aircraft_id = @gv_id
    INTO CORRESPONDING FIELDS OF @gs_check.

*-- 변수 선언
  DATA : lv_order(6) TYPE n,
         lv_as(6)    TYPE n,
         lv_count    TYPE i,
         lv_type,
         ls_amount   TYPE i,
         lv_hindex   TYPE i,
         lv_iindex   TYPE i.

*-- Function Module 호출
  call function 'ZC103PMFG0001'
    IMPORTING
      empno   = gv_empno
      empname = gv_empname.

  IF gv_empno IS NOT INITIAL.

*-- 누적 비행 시간을 통한 정비 오더 계산
    LOOP AT gt_time ASSIGNING FIELD-SYMBOL(<fs>).

      CLEAR : gs_ooh, gs_ooi, lv_count.

      IF ( gs_check-fh_since_last_d + <fs>-flighttime ) > 24000.

        lv_count = 5.
        lv_type = 'O'.
        gs_ooi-description    = 'D-Check Overhaul'.
        gs_ooi-duration       = 1200.

        gs_check-fh_since_last_d = 0.

      ELSEIF ( gs_check-fh_since_last_c + <fs>-flighttime ) > 6000.

        lv_count = 4.
        lv_type = 'R'.
        gs_ooi-description    = 'C-Check Maintenance'.
        gs_ooi-duration       = 120.

        gs_check-fh_since_last_c = 0.

      ELSEIF ( gs_check-fh_since_last_a + <fs>-flighttime ) > 600.

        lv_count = 3.
        lv_type = 'M'.
        gs_ooi-description    = 'A-Check Maintenance'.
        gs_ooi-duration       = 5.

        gs_check-fh_since_last_a = 0.

      ELSE.

        lv_count = 2.
        lv_type = 'D'.
        gs_ooi-description    = 'Daily Inspection'.
        gs_ooi-duration       = 1.

      ENDIF.

*-- Number Range Object 호출
      CALL FUNCTION 'NUMBER_GET_NEXT'
        EXPORTING
          nr_range_nr = '01'
          object      = 'ZC103PM01'
        IMPORTING
          number      = lv_order.

*-- 정비 오더 헤더 생성
      gs_ooh-order_id     = |PM{ lv_order }|.
      gs_ooh-aircraft_id  = gv_id.
      gs_ooh-scheduleid   = <fs>-scheduleid.
      gs_ooh-maint_type   = lv_type.
      gs_ooh-plan_date    = <fs>-departdate.
      gs_ooh-release_date = gv_today.
      gs_ooh-remarks      = |승인자 : { gv_empname }|.
      gs_ooh-erdat        = sy-datum.
      gs_ooh-erzet        = sy-uzeit.
      gs_ooh-ernam        = sy-uname.
      gs_ooi-order_id     = gs_ooh-order_id.
      gs_ooi-erdat        = sy-datum.
      gs_ooi-erzet        = sy-uzeit.
      gs_ooi-ernam        = sy-uname.

      PERFORM exec_bdc_header.

      lv_hindex += 1.

*-- 정비 오더 아이템 생성
      DO lv_count TIMES.
        CLEAR gv_index.
        gv_index = sy-index.
        CALL FUNCTION 'NUMBER_GET_NEXT'
          EXPORTING
            nr_range_nr = '01'
            object      = 'ZC103PM02'
          IMPORTING
            number      = lv_as.

        gs_ooi-operation_id   = |AS{ lv_as }|.
        gs_ooi-skill_type     = gt_as[ gv_index ].

        PERFORM exec_bdc_item.
        lv_iindex += 1.
      ENDDO.

    ENDLOOP.

    PERFORM get_data_0100.
    PERFORM set_data_0100.
    PERFORM refresh_table USING go_disp_sch_alv.
    PERFORM set_chart_data.

    MESSAGE s001 WITH |정비 오더 { lv_hindex }건, 작업 항목 { lv_iindex }건이 생성되었습니다. |.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exec_bdc_header
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exec_bdc_header.

*-- Set BDC Data
  CLEAR : gt_bdcdata, gs_bdcdata.
  PERFORM dynpro USING : 'X' 'SAPMZC103PM0002'              '0200'   ,
                         ' ' 'BDC_OKCODE'                   '=SAVEH' ,
                         ' ' 'GS_SAVE_OOH-ORDER_ID'         gs_ooh-order_id,
                         ' ' 'GS_SAVE_OOH-AIRCRAFT_ID'      gs_ooh-aircraft_id,
                         ' ' 'GS_SAVE_OOH-SCHEDULEID'       gs_ooh-scheduleid,
                         ' ' 'GS_SAVE_OOH-MAINT_TYPE'       gs_ooh-maint_type,
                         ' ' 'GS_SAVE_OOH-PLAN_DATE'        gs_ooh-plan_date,
                         ' ' 'GS_SAVE_OOH-RELEASE_DATE'     gs_ooh-release_date,
                         ' ' 'GS_SAVE_OOH-REMARKS'          gs_ooh-remarks,
                         ' ' 'GS_SAVE_OOH-ERDAT'            gs_ooh-erdat,
                         ' ' 'GS_SAVE_OOH-ERZET'            gs_ooh-erzet,
                         ' ' 'GS_SAVE_OOH-ERNAM'            gs_ooh-ernam .

*-- Set BDC Optrion
  gs_params-dismode   = 'N'.
  gs_params-updmode   = 'A'.
  gs_params-nobiend   = space.
  gs_params-racommit  = 'X'.

*-- Execute BDC by Call transaction
  CALL TRANSACTION 'ZC103PM0002200'
                      USING gt_bdcdata
                      OPTIONS FROM gs_params
                      MESSAGES INTO gt_msg.

*-- 성공 여부 판별
  CLEAR gs_msg.
  gs_msg = VALUE #( gt_msg[ KEY key msgid = 'BC402_C62'
                                    msgnr = '015' ] OPTIONAL ).
  IF sy-subrc EQ 0.

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gs_msg-msgid
        msgnr               = gs_msg-msgnr
        msgv1               = gs_msg-msgv1
        msgv2               = gs_msg-msgv2
        msgv3               = gs_msg-msgv3
        msgv4               = gs_msg-msgv4
      IMPORTING
        message_text_output = gv_msg.

    MESSAGE s000 WITH gv_msg.

  ELSE.

    gs_msg = VALUE #( gt_msg[ lines( gt_msg ) ] OPTIONAL ).

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gs_msg-msgid
        msgnr               = gs_msg-msgnr
        msgv1               = gs_msg-msgv1
        msgv2               = gs_msg-msgv2
        msgv3               = gs_msg-msgv3
        msgv4               = gs_msg-msgv4
      IMPORTING
        message_text_output = gv_msg.

    MESSAGE s000 WITH gv_msg DISPLAY LIKE 'E'.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exec_bdc_item
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exec_bdc_item.

  DATA : lv_dur(10).

  lv_dur = gs_ooi-duration.
  CONDENSE lv_dur NO-GAPS.

*-- Set BDC Data
  CLEAR : gt_bdcdata, gs_bdcdata.
  PERFORM dynpro USING : 'X' 'SAPMZC103PM0002'              '0300'   ,
                         ' ' 'BDC_OKCODE'                   '=SAVEI' ,
                         ' ' 'GS_SAVE_OOI-ORDER_ID'       gs_ooi-order_id,
                         ' ' 'GS_SAVE_OOI-OPERATION_ID'   gs_ooi-operation_id,
                         ' ' 'GS_SAVE_OOI-DESCRIPTION'    gs_ooi-description,
                         ' ' 'GS_SAVE_OOI-DURATION'       lv_dur,
                         ' ' 'GS_SAVE_OOI-SKILL_TYPE'     gs_ooi-skill_type,
                         ' ' 'GS_SAVE_OOI-REMARKS '       gs_ooi-remarks,
                         ' ' 'GS_SAVE_OOI-ERDAT'          gs_ooi-erdat,
                         ' ' 'GS_SAVE_OOI-ERZET'          gs_ooi-erzet,
                         ' ' 'GS_SAVE_OOI-ERNAM'          gs_ooi-ernam.

*-- Set BDC Optrion
  gs_params-dismode   = 'N'.
  gs_params-updmode   = 'A'.
  gs_params-nobiend   = space.
  gs_params-racommit  = 'X'.

*-- Execute BDC by Call transaction
  CALL TRANSACTION 'ZC103PM0002300'
                      USING gt_bdcdata
                      OPTIONS FROM gs_params
                      MESSAGES INTO gt_msg.

*-- 성공 여부 판별
  CLEAR gs_msg.
  gs_msg = VALUE #( gt_msg[ KEY key msgid = 'BC402_C62'
                                    msgnr = '015' ] OPTIONAL ).
  IF sy-subrc EQ 0.

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gs_msg-msgid
        msgnr               = gs_msg-msgnr
        msgv1               = gs_msg-msgv1
        msgv2               = gs_msg-msgv2
        msgv3               = gs_msg-msgv3
        msgv4               = gs_msg-msgv4
      IMPORTING
        message_text_output = gv_msg.

    MESSAGE s000 WITH gv_msg.

  ELSE.

    gs_msg = VALUE #( gt_msg[ lines( gt_msg ) ] OPTIONAL ).

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gs_msg-msgid
        msgnr               = gs_msg-msgnr
        msgv1               = gs_msg-msgv1
        msgv2               = gs_msg-msgv2
        msgv3               = gs_msg-msgv3
        msgv4               = gs_msg-msgv4
      IMPORTING
        message_text_output = gv_msg.

    MESSAGE s000 WITH gv_msg DISPLAY LIKE 'E'.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form dynpro
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> PV_DYNPRO
*&      --> PV_FNAME
*&      --> PV_FVAL
*&---------------------------------------------------------------------*
FORM dynpro  USING    pv_dynpro
                      pv_fname
                      pv_fval.

  CLEAR: gs_bdcdata.
  CASE pv_dynpro.
    WHEN 'X'.
      gs_bdcdata-dynbegin = pv_dynpro.        " BDC Dynpro Start
      gs_bdcdata-program  = pv_fname.         " BDC Program Name
      gs_bdcdata-dynpro   = pv_fval.          " BDC Dynpro Number
    WHEN OTHERS.
      gs_bdcdata-fnam     = pv_fname.         " BDC field name
      gs_bdcdata-fval     = pv_fval.          " BDC field value
  ENDCASE.

  APPEND gs_bdcdata TO gt_bdcdata.
  CLEAR gs_bdcdata.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form get_data_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM get_data_0100 .

  gt_as = VALUE #(
                    ( skill_type = '기체' )
                    ( skill_type = '항공전자' )
                    ( skill_type = '엔진' )
                    ( skill_type = '구조물' )
                    ( skill_type = '내부장비' )
                 ).

*-- Get Base Schedule Data
  gv_today = sy-datum.

  CALL FUNCTION 'RP_CALC_DATE_IN_INTERVAL'
    EXPORTING
      date      = gv_today
      days      = 0
      months    = 1
      years     = 0
    IMPORTING
      calc_date = gv_next_month.

  CLEAR gt_sch.

  zclc103pm_amdp01=>get_schedule(
    EXPORTING
      iv_departdate = gv_today
      iv_arrivedate = gv_next_month
    IMPORTING
      et_result     = DATA(lt_sch)
  ).
  gt_sch = CORRESPONDING #( lt_sch ).

  SORT gt_sch BY scheduleid.

*-- Get Order Data
  SELECT
    FROM zc103pmt0004
    FIELDS order_id, aircraft_id, scheduleid, maint_type,
           plan_date, release_date, close_date, remarks
    INTO CORRESPONDING FIELDS OF TABLE @gt_order.

*-- Get Domain Value
  SELECT
    FROM dd07v
    FIELDS domvalue_l, ddtext
    WHERE domname = 'ZC103D_FI_LAND'
    INTO CORRESPONDING FIELDS OF TABLE @gt_dd07v.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_data_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_data_0100 .

*-- 버튼 속성 정의
  gv_make_status   = 'H'.
  gv_green_status  = 'E'.
  gv_yellow_status = 'E'.

*-- 변수 초기화
  CLEAR : gt_disp_sch, gv_int,
          gv_rp01, gv_gp01, gv_yp01,
          gv_rp02, gv_gp02, gv_yp02,
          gv_rp03, gv_gp03, gv_yp03,
          gv_rp04, gv_gp04, gv_yp04,
          gv_rp05, gv_gp05, gv_yp05,
          gv_rp06, gv_gp06, gv_yp06.

*-- 변수 선언
  DATA : lv_data LIKE gs_order,
         lv_name TYPE string.

*-- 조회용 데이터 세팅
  LOOP AT gt_sch ASSIGNING FIELD-SYMBOL(<fs>).

    CLEAR : gs_disp_sch, lv_data, gs_cell_tab, lv_name.

*-- 텍스트 데이터 삽입
    gs_disp_sch = VALUE #(
                            scheduleid  = <fs>-scheduleid
                            flightid    = <fs>-flightid
                            countryfrom = gt_dd07v[ KEY key domvalue_l = <fs>-countryfrom ]-ddtext
                            countryto   = gt_dd07v[ KEY key domvalue_l = <fs>-countryto ]-ddtext
                            departdate  = <fs>-departdate
                            departtime  = <fs>-departtime
                            arrivedate  = <fs>-arrivedate
                            arrivetime  = <fs>-arrivetime
                            flighttime  = <fs>-flighttime
                            erdat       = <fs>-erdat
                            erzet       = <fs>-erzet
                            ernam       = <fs>-ernam
                            aedat       = <fs>-aedat
                            aezet       = <fs>-aezet
                            aenam       = <fs>-aenam
                         ).

*-- 정비 오더 유무 확인
    lv_data = VALUE #( gt_order[ KEY schkey scheduleid = <fs>-scheduleid ] OPTIONAL ).

*-- 정비 오더 생성이 가능한 경우( 도착 도시가 '00'일 경우 )
    IF <fs>-countryto EQ '00'.

*-- 정비 오더가 이미 생성된 경우
      IF lv_data IS NOT INITIAL.

        gs_disp_sch-status = icon_led_green.
        gs_disp_sch-order  = icon_display_text.
        gs_cell_tab = VALUE lvc_s_styl( fieldname = 'ORDER'
                                        style     = cl_gui_alv_grid=>mc_style_button ).

        lv_name = |gv_g{ <fs>-flightid }|.
        ASSIGN (lv_name) TO <fs_name>.

        <fs_name> += 1.

        INSERT gs_cell_tab INTO TABLE gs_disp_sch-celltab.

*-- 정비 오더가 생성되지 않은 경우
      ELSE.

        gs_disp_sch-status = icon_led_yellow.

        lv_name = |gv_y{ <fs>-flightid }|.
        ASSIGN (lv_name) TO <fs_name>.

        <fs_name> += 1.

      ENDIF.

*-- 정비 오더 생성이 불가능할 경우( 도착 도시가 '00'이 아닌 경우 )
    ELSE.

      lv_name = |gv_r{ <fs>-flightid }|.
      ASSIGN (lv_name) TO <fs_name>.

      <fs_name> += 1.

    ENDIF.

*-- 가공된 데이터를 조회용 테이블에 삽입
    gt_disp_sch = VALUE #( BASE gt_disp_sch ( gs_disp_sch ) ).
    UNASSIGN <fs_name>.

  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_data_green
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_data_green.

*-- Set Display Data
  LOOP AT gt_disp_sch ASSIGNING FIELD-SYMBOL(<fs>) WHERE status NE icon_led_green.


    CLEAR gv_tabix.
    gv_tabix = sy-tabix.

    DELETE gt_disp_sch INDEX gv_tabix.

  ENDLOOP.

  gv_make_status = 'H'.
  gv_green_status = 'H'.
  gv_yellow_status = 'H'.

  PERFORM refresh_table USING go_disp_sch_alv.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_data_yellow
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_data_yellow.

*-- Set Display Data
  LOOP AT gt_disp_sch ASSIGNING FIELD-SYMBOL(<fs>) WHERE status NE icon_led_yellow.


    CLEAR gv_tabix.
    gv_tabix = sy-tabix.

    DELETE gt_disp_sch INDEX gv_tabix.

  ENDLOOP.

  gv_make_status = 'H'.
  gv_green_status = 'H'.
  gv_yellow_status = 'H'.

  PERFORM refresh_table USING go_disp_sch_alv.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_data_clic
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_data_click USING pa_id.
  gv_make_status = 'E'.
  CLEAR : gt_disp_sch, gv_int, gt_time, gv_id, gv_num,
          gv_rp01, gv_gp01, gv_yp01,
          gv_rp02, gv_gp02, gv_yp02,
          gv_rp03, gv_gp03, gv_yp03,
          gv_rp04, gv_gp04, gv_yp04,
          gv_rp05, gv_gp05, gv_yp05,
          gv_rp06, gv_gp06, gv_yp06.

  gv_id = pa_id.

  DATA : lv_data LIKE gs_order,
         lv_name TYPE string.

*-- Set Display Data
  LOOP AT gt_sch ASSIGNING FIELD-SYMBOL(<fs>) WHERE flightid = pa_id.

    CLEAR : gs_disp_sch, lv_data, gs_cell_tab, lv_name, gs_time.
    gs_time-scheduleid = <fs>-scheduleid.
    gv_int += <fs>-flighttime.
    gs_time-flighttime = gv_int.
    gs_time-departdate = <fs>-departdate.
*-- Insert Domain Value
    gs_disp_sch = VALUE #(
                            scheduleid  =   <fs>-scheduleid
                            flightid    =   <fs>-flightid
                            countryfrom =   gt_dd07v[ KEY key domvalue_l = <fs>-countryfrom ]-ddtext
                            countryto   =   gt_dd07v[ KEY key domvalue_l = <fs>-countryto ]-ddtext
                            departdate  =   <fs>-departdate
                            departtime  =   <fs>-departtime
                            arrivedate  =   <fs>-arrivedate
                            arrivetime  =   <fs>-arrivetime
                            flighttime  =   <fs>-flighttime
                            erdat       =   <fs>-erdat
                            erzet       =   <fs>-erzet
                            ernam       =   <fs>-ernam
                            aedat       =   <fs>-aedat
                            aezet       =   <fs>-aezet
                            aenam       =   <fs>-aenam
                         ).

    lv_data = VALUE #( gt_order[ KEY schkey scheduleid = <fs>-scheduleid ] OPTIONAL ).

    IF <fs>-countryto EQ '00'.
      IF lv_data IS NOT INITIAL.
        gs_disp_sch-status = icon_led_green.
        gs_disp_sch-order  = icon_display_text.
        gs_cell_tab = VALUE lvc_s_styl( fieldname = 'ORDER'
                                   style = cl_gui_alv_grid=>mc_style_button ).

        lv_name = |gv_g{ <fs>-flightid }|.
        ASSIGN (lv_name) TO <fs_name>.

        <fs_name> += 1.

        INSERT gs_cell_tab INTO TABLE gs_disp_sch-celltab.

*-- Time Check
        IF gs_check-fh_since_last_d + gs_time-flighttime > 2400.

          gs_check-fh_since_last_d = 0.

        ENDIF.

        IF gs_check-fh_since_last_c + gs_time-flighttime > 6000.

          gs_check-fh_since_last_c = 0.

        ENDIF.

        IF gs_check-fh_since_last_a + gs_time-flighttime > 600.

          gs_check-fh_since_last_a = 0.

        ENDIF.

      ELSE.

        gs_disp_sch-status = icon_led_yellow.
        gv_num += 1.
        lv_name = |gv_y{ <fs>-flightid }|.
        ASSIGN (lv_name) TO <fs_name>.

        <fs_name> += 1.
        APPEND gs_time TO gt_time.

      ENDIF.
    ELSE.

      lv_name = |gv_r{ <fs>-flightid }|.
      ASSIGN (lv_name) TO <fs_name>.

      <fs_name> += 1.

    ENDIF.

    gt_disp_sch = VALUE #( BASE gt_disp_sch ( gs_disp_sch ) ).
    UNASSIGN <fs_name>.

  ENDLOOP.
  IF gv_num IS INITIAL.
    gv_make_status = 'H'.
  ELSE.
    gv_make_status = 'E'.
  ENDIF.
  gv_green_status = 'E'.
  gv_yellow_status = 'E'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_field_catalog_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_field_catalog_0100 .

*-- Setting Field catalog To Display Data
  gt_disp_sch_fcat = VALUE #(
                              ( coltext = '상태'           col_pos = 1  fieldname = 'STATUS' just = 'C' )
                              ( ref_table = 'ZC103SDT0008' col_pos = 2  fieldname = 'SCHEDULEID' key = abap_true just = 'C' )
                              ( ref_table = 'ZC103SDT0008' col_pos = 3  fieldname = 'FLIGHTID' just = 'C'    )
                              ( coltext = '출발도시'       col_pos = 4  fieldname = 'COUNTRYFROM' emphasize = 'X' )
                              ( ref_table = 'ZC103SDT0008' col_pos = 5  fieldname = 'DEPARTDATE'  just = 'C' )
                              ( ref_table = 'ZC103SDT0008' col_pos = 6  fieldname = 'DEPARTTIME' just = 'C'  )
                              ( coltext = '도착도시'       col_pos = 7  fieldname = 'COUNTRYTO'   emphasize = 'X' )
                              ( ref_table = 'ZC103SDT0008' col_pos = 8  fieldname = 'ARRIVEDATE' just = 'C'  )
                              ( ref_table = 'ZC103SDT0008' col_pos = 9  fieldname = 'ARRIVETIME' just = 'C'  )
                              ( coltext = '비행시간'       col_pos = 10 fieldname = 'FLIGHTTIME' do_sum = abap_true )
                              ( coltext = '주문오더'       col_pos = 11 fieldname = 'ORDER' just = 'C' )
                           ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_layout_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_layout_0100 .

*-- Set layout
  gs_disp_sch_layout  = VALUE #( zebra = abap_true
                                 cwidth_opt = 'A'
                                 sel_mode = 'D'
                                 stylefname = 'CELLTAB'
                                 totals_bef = abap_true
                               ).

*-- Set Variant
  gs_variant = VALUE #( report = sy-repid ).

*-- Set sort
  gt_disp_sch_sort = VALUE #(
                              ( fieldname = 'FLIGHTID'   up = abap_true spos = '1' subtot = abap_true )
                              ( fieldname = 'SCHEDULEID' up = abap_true spos = '2' )
                            ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_object_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_object_0100 .

*-- Top Of Page
  CREATE OBJECT go_top_container
    EXPORTING
      repid     = sy-cprog
      dynnr     = sy-dynnr
      side      = go_top_container->dock_at_top
      extension = 80.

*-- Base Con
  CREATE OBJECT go_0100_con
    EXPORTING
      side      = go_0100_con->dock_at_left
      extension = 5000.

  _split_create go_0100_spt go_0100_con 1 3.

*-- Create SCH ALV(Left)
  _split_get go_0100_spt 1 2 go_disp_sch_con.
  _obj go_disp_sch_alv go_disp_sch_con.

*-- Create List Tree(Right)
  DATA: l_header_text TYPE treev_hhdr,
        l_list_text   TYPE treev_lhdr.

  l_header_text-heading = 'Object Name'.
  l_header_text-width = 40.
  l_list_text-heading = 'Description'.

  _split_get go_0100_spt 1 1 go_list_con.
  CREATE OBJECT go_list_tree
    EXPORTING
      parent              = go_list_con
      node_selection_mode = cl_gui_list_tree=>node_sel_mode_single
      item_selection      = 'X'
      hierarchy_header    = l_header_text
      list_header         = l_list_text
      with_headers        = 'X'.

*-- Set Width
  go_0100_spt->set_column_width(
    EXPORTING
      id                = 2
      width             = 50
  ).
  go_0100_spt->set_column_width(
    EXPORTING
      id                = 3
      width             = 33
  ).

*-- Create TOP-Document
  CREATE OBJECT go_dyndoc_id
    EXPORTING
      style = 'ALV_GRID'.

  PERFORM list_tree_event.

*- Create Chart
  _split_get go_0100_spt 1 3 go_chart_con.

  CREATE OBJECT go_chart_eng
    EXPORTING
      parent = go_chart_con.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_chart
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_chart .

  PERFORM set_chart_data.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_chart_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_chart_data .

  CLEAR : go_ixml,
           go_ixml_sf,
           go_ixml_docu,
           go_ixml_ostream,
           go_ixml_encoding,
           go_chartdata,
           go_categories,
           go_category,
           go_series,
           go_point,
           go_value.

  CLEAR : gv_xstring.

  go_ixml = cl_ixml=>create(  ).
  go_ixml_sf = go_ixml->create_stream_factory( ).

  go_ixml_docu = go_ixml->create_document( ).

  go_ixml_encoding = go_ixml->create_encoding(
                       byte_order    = if_ixml_encoding=>co_little_endian
                       character_set = 'utf-8' ).

  go_ixml_docu->set_encoding( encoding = go_ixml_encoding ).

*-- Now build a DOM, representing an XML document with chart data
  go_chartdata = go_ixml_docu->create_simple_element(
                                        name   = 'ChartData'
                                        parent = go_ixml_docu ).

*-- Categories (parent)
  go_categories = go_ixml_docu->create_simple_element(
                                        name   = 'Categories'
                                        parent = go_chartdata ).

  PERFORM set_category_value.
  PERFORM set_chart_value.

  go_chart_eng->set_data( xdata = gv_xstring ).
  go_chart_eng->render( ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_category_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_category_value .

  DATA : lv_value TYPE string.

*-- Categories (children)
  go_category = go_ixml_docu->create_simple_element(
                                        name   = 'Category'
                                        parent = go_categories ).
  go_category->if_ixml_node~set_value( '정비 오더 생성 완료' ).


  go_category = go_ixml_docu->create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category->if_ixml_node~set_value( '정비 오더 대상 노선' ).

  go_category = go_ixml_docu->create_simple_element(
                                      name   = 'Category'
                                      parent = go_categories ).
  go_category->if_ixml_node~set_value( '정비 오더 비대상 노선' ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_chart_value
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_chart_value .

*-- 변수 초기화 및 항공기 설정
  DATA : lv_value TYPE string,
         lv_name  TYPE string.
  gt_value = VALUE #( ( name = 'P01' )
                      ( name = 'P02' )
                      ( name = 'P03' )
                      ( name = 'P04' )
                      ( name = 'P05' )
                      ( name = 'P06' ) ).

  LOOP AT gt_value ASSIGNING FIELD-SYMBOL(<fs>).

    CLEAR lv_name.

*-- Build series (we need only 1)
    lv_value = <fs>-name.
    go_series = go_ixml_docu->create_simple_element(
                                                      name = 'Series'
                                                      parent = go_chartdata ).
    go_series->set_attribute( name  = 'label'
                              value = lv_value ). "'Series1' ).

*-- 정비 오더 생성된 스케줄
    lv_name = |gv_g{ <fs>-name }|.
    ASSIGN (lv_name) TO <fs_name>.
    lv_value = <fs_name>.
    go_point = go_ixml_docu->create_simple_element(
                                                    name = 'Point'
                                                    parent = go_series ).
    go_point->set_attribute( name  = 'label'
                             value = lv_value ).
    go_value = go_ixml_docu->create_simple_element(
                                                    name = 'Value'
                                                    parent = go_point ).
    go_value->if_ixml_node~set_value( lv_value ).

*-- 정비 오더 생성 가능한 스케줄
    lv_name = |gv_y{ <fs>-name }|.
    ASSIGN (lv_name) TO <fs_name>.
    lv_value = <fs_name>.
    go_point = go_ixml_docu->create_simple_element(
                                                    name = 'Point'
                                                    parent = go_series ).
    go_point->set_attribute( name  = 'label'
                             value = lv_value ).
    go_value = go_ixml_docu->create_simple_element(
                                                    name = 'Value'
                                                    parent = go_point ).
    go_value->if_ixml_node~set_value( lv_value ).

*-- 정비 오더가 생성 불가능한 스케줄
    lv_name = |gv_r{ <fs>-name }|.
    ASSIGN (lv_name) TO <fs_name>.
    lv_value = <fs_name>.
    go_point = go_ixml_docu->create_simple_element(
                                                    name = 'Point'
                                                    parent = go_series ).
    go_point->set_attribute( name  = 'label'
                             value = lv_value ).
    go_value = go_ixml_docu->create_simple_element(
                                                    name = 'Value'
                                                    parent = go_point ).
    go_value->if_ixml_node~set_value( lv_value ).
    UNASSIGN <fs_name>.

  ENDLOOP.

*-- create ostream (into string variable) and render document into stream
  go_ixml_ostream = go_ixml_sf->create_ostream_xstring( gv_xstring ).
  go_ixml_docu->render( go_ixml_ostream ). "here f_xstring is filled

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_event_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_event_0100 .

  SET HANDLER : lcl_event_handler=>top_of_page               FOR go_disp_sch_alv,
                lcl_event_handler=>edit_toolbar              FOR go_disp_sch_alv,
                lcl_event_handler=>button_click              FOR go_disp_sch_alv,
                lcl_event_handler=>user_command              FOR go_disp_sch_alv,
                lcl_event_handler=>handle_expand_no_children FOR go_list_tree,
                lcl_event_handler=>handle_item_click         FOR go_list_tree,
                lcl_event_handler=>chart_click               FOR go_chart_eng.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_alv_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_alv_0100 .

*-- Set variant handle & Dispaly alv
  gs_variant-handle = 'SCHEDULE'.
  gs_disp_sch_layout-grid_title = '항공기 스케줄'.
  go_disp_sch_alv->set_table_for_first_display(
    EXPORTING
      is_variant                    = gs_variant
      i_save                        = 'A'
      i_default                     = 'X'
      is_layout                     = gs_disp_sch_layout
      it_toolbar_excluding          = gt_ui_functions
    CHANGING
      it_outtab                     = gt_disp_sch
      it_fieldcatalog               = gt_disp_sch_fcat
      it_sort                       = gt_disp_sch_sort
  ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form register_event
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM register_event_0100 .

  CALL METHOD go_dyndoc_id->initialize_document
    EXPORTING
      background_color = cl_dd_area=>col_textarea.

  CALL METHOD go_disp_sch_alv->list_processing_events
    EXPORTING
      i_event_name = 'TOP_OF_PAGE'
      i_dyndoc_id  = go_dyndoc_id.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form event_top_of_page
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM event_top_of_page .

  DATA : lr_dd_table TYPE REF TO cl_dd_table_element,
         col_field   TYPE REF TO cl_dd_area,
         col_value   TYPE REF TO cl_dd_area.

  DATA : lv_text TYPE sdydo_text_element,
         lv_icon TYPE icon-id.

  CALL METHOD go_dyndoc_id->add_table
    EXPORTING
      no_of_columns = 2
      border        = '0'
    IMPORTING
      table         = lr_dd_table.

*-- Set column
  CALL METHOD lr_dd_table->add_column
    IMPORTING
      column = col_field.

  CALL METHOD lr_dd_table->add_column
    IMPORTING
      column = col_value.

*-- 기준 연도
  lv_text = gv_today(4) && '년'.
  PERFORM add_row USING lr_dd_table col_field col_value '기준연도' lv_text.

*-- 기준 날짜
  lv_text = gv_today+4(2) && '월' && gv_today+6(2) && '일'.
  PERFORM add_row USING lr_dd_table col_field col_value '기준날짜' lv_text.

*-- Description
  lv_text = |{ gv_today(4) }년 { gv_today+4(2) }월 { gv_today+6(2) }일 ~ { gv_next_month(4) }년 { gv_next_month+4(2) }월 { gv_next_month+6(2) }일|.
  PERFORM add_row USING lr_dd_table col_field col_value '조회조건' lv_text.

*-- Icon
  lv_text = 'GREEN'.
  PERFORM add_row USING lr_dd_table col_field col_value '정비 오더 생성 완료' lv_text.

  lv_text = 'YELLOW'.
  PERFORM add_row USING lr_dd_table col_field col_value '정비 오더 대상 노선' lv_text.

  PERFORM add_row USING lr_dd_table col_field col_value '정비 오더 비대상 노선' ' '.

  PERFORM set_top_of_page.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form add_row
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> LR_DD_TABLE
*&      --> COL_FIELD
*&      --> COL_VALUE
*&      --> P_
*&      --> LV_TEXT
*&---------------------------------------------------------------------*
FORM add_row  USING pr_dd_table  TYPE REF TO cl_dd_table_element
                    pv_col_field TYPE REF TO cl_dd_area
                    pv_col_value TYPE REF TO cl_dd_area
                    pv_field
                    pv_text.

  DATA : lv_text TYPE sdydo_text_element,
         lv_icon TYPE iconname.

*-- Field.
  lv_text = pv_field.

  CALL METHOD pv_col_field->add_text
    EXPORTING
      text         = lv_text
      sap_emphasis = cl_dd_document=>strong
      sap_color    = cl_dd_document=>list_heading_inv.

  CALL METHOD pv_col_field->add_gap
    EXPORTING
      width = 3.

*-- Value.
  CASE pv_text.
    WHEN 'GREEN'.
      CALL METHOD pv_col_value->add_icon
        EXPORTING
          sap_icon = 'ICON_LED_GREEN'.
    WHEN 'RED'.
      CALL METHOD pv_col_value->add_icon
        EXPORTING
          sap_icon = 'ICON_LED_RED'.
    WHEN 'YELLOW'.
      CALL METHOD pv_col_value->add_icon
        EXPORTING
          sap_icon = 'ICON_LED_YELLOW'.
    WHEN OTHERS.
      lv_text = pv_text.
      CALL METHOD pv_col_value->add_text
        EXPORTING
          text         = lv_text
          sap_emphasis = cl_dd_document=>heading
          sap_color    = cl_dd_document=>list_negative_inv.
  ENDCASE.

  CALL METHOD pv_col_value->add_gap
    EXPORTING
      width = 3.

  CALL METHOD pr_dd_table->new_row.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_top_of_page
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_top_of_page .

* Creating html control
  IF go_html_cntrl IS INITIAL.
    CREATE OBJECT go_html_cntrl
      EXPORTING
        parent = go_top_container.
  ENDIF.

  CALL METHOD go_dyndoc_id->merge_document.
  go_dyndoc_id->html_control = go_html_cntrl.

* Display document
  CALL METHOD go_dyndoc_id->display_document
    EXPORTING
      reuse_control      = 'X'
      parent             = go_top_container
    EXCEPTIONS
      html_display_error = 1.

  IF sy-subrc NE 0.
    MESSAGE s001 WITH TEXT-e01 DISPLAY LIKE 'E'.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_list_tree_0100
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_list_tree_0100 .

  PERFORM build_node_and_item_table USING node_table item_table.

  node_key_table = VALUE #(
                            ( 'Root' )
                            ( 'Child1' )
                            ( 'Child2' )
                          ).


  CALL METHOD go_list_tree->add_nodes_and_items
    EXPORTING
      node_table                = node_table
      item_table                = item_table
      item_table_structure_name = 'MTREEITM'.

  CALL METHOD go_list_tree->expand_root_nodes.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form build_node_and_item_table
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> NODE_TABLE
*&      --> ITEM_TABLE
*&---------------------------------------------------------------------*
FORM build_node_and_item_table  USING     note_table TYPE treev_ntab
                                          item_table LIKE item_table.

  DATA : node TYPE treev_node, item TYPE mtreeitm.
  node-node_key = 'Root'.
  node-n_image = '@06@'.
  node-exp_image = '@07@'.
  node-isfolder = 'X'."folder.
  node-expander = 'X'.
  APPEND node TO node_table.

  CLEAR item.
  item-node_key = 'Root'.
  item-item_name = '1'.
  item-alignment = cl_gui_list_tree=>align_auto.
  item-text = '항공기 기종'.
  APPEND item TO item_table.

  CLEAR node.
  node-node_key = 'Child1'.
  node-relatkey = 'Root'.
  node-n_image  = '@54@'.
  node-exp_image = '@55@'.
  node-isfolder = 'X'.
  node-expander = 'X'.
  APPEND node TO node_table.

  CLEAR item.
  item-node_key = 'Child1'.
  item-item_name = '1'.
  item-alignment = cl_gui_list_tree=>align_auto.
  item-text = 'A321XLR'.
  APPEND item TO item_table.

  CLEAR node.
  node-node_key = 'Child2'.
  node-relatkey = 'Root'.
  node-n_image  = '@54@'.
  node-exp_image = '@55@'.
  node-isfolder = 'X'.
  node-expander = 'X'.
  APPEND node TO node_table.

  CLEAR item.
  item-node_key = 'Child2'.
  item-item_name = '1'.
  item-alignment = cl_gui_list_tree=>align_auto.
  item-text = 'B787-9'.
  APPEND item TO item_table.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form list_tree_event
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM list_tree_event .

  DATA : events TYPE cntl_simple_events.
  DATA : event  TYPE cntl_simple_event.
  event-eventid = cl_gui_list_tree=>eventid_expand_no_children.
  event-appl_event = 'X'.
  APPEND event TO events.
  event-eventid = cl_gui_list_tree=>eventid_button_click.
  event-appl_event = 'X'.
  APPEND event TO events.
  CALL METHOD go_list_tree->set_registered_events
    EXPORTING
      events = events.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form salv_display
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM salv_display USING pv_scheduleid TYPE  zc103e_sd_scheduleid.

  DATA: lo_container TYPE REF TO cl_gui_dialogbox_container,
        lo_columns   TYPE REF TO cl_salv_columns_table,
        lo_column    TYPE REF TO cl_salv_column_table,
        ls_color     TYPE lvc_s_colo.

  CLEAR gt_disp_order.

  LOOP AT gt_order ASSIGNING FIELD-SYMBOL(<fs>)
    USING KEY schkey WHERE scheduleid = pv_scheduleid.
    APPEND <fs> TO gt_disp_order.
  ENDLOOP.

  " 팝업 컨테이너 생성
  CREATE OBJECT lo_container
    EXPORTING
      width   = 600
      height  = 100
      top     = 100
      left    = 100
      caption = '정비 오더'.

  " 핸들러 연결 (X버튼 눌렀을 때 close 이벤트 처리)
  SET HANDLER lcl_event_handler=>on_close FOR lo_container.

* Simple ALV 출력
  TRY.
      "리스트 생성
      cl_salv_table=>factory(
  EXPORTING
    r_container  = lo_container
        IMPORTING
          r_salv_table = DATA(lo_alv)
        CHANGING
          t_table      = gt_disp_order  ).

*      " 열 너비 자동 최적화
      lo_alv->get_columns( )->set_optimize( ).

      lo_columns = lo_alv->get_columns( ).

      TRY.
          lo_column ?= lo_columns->get_column( 'ORDER_ID' ).
        CATCH cx_salv_not_found INTO DATA(lx_salv_nf).
          MESSAGE lx_salv_nf->get_text( ) TYPE 'E'.
      ENDTRY.
      ls_color-col = 1.
      ls_color-int = 1.
      lo_column->set_color( ls_color ).

      lo_alv->display( ).

    CATCH cx_salv_msg INTO DATA(lx_salv).
      MESSAGE s000 WITH
      | ❌ ALV 표시 실패:{ lx_salv->get_text( ) }| DISPLAY LIKE 'E'.
  ENDTRY.

ENDFORM.
